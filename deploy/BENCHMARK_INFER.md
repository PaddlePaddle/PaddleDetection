# 推理Benchmark

## 环境准备
- 测试环境:
  - CUDA 10.1
  - CUDNN 7.6
  - TensorRT-6.0.1
  - PaddlePaddle v2.0.1
  - GPU分别为: Tesla V100和Windows 1080Ti和TX2
- 测试方式:
  - 为了方便比较不同模型的推理速度，输入采用同样大小的图片，为 3x640x640，采用 `demo/000000014439_640x640.jpg` 图片。
  - Batch Size=1
  - 去掉前100轮warmup时间，测试100轮的平均时间，单位ms/image，包括网络计算时间、数据拷贝至CPU的时间。
  - 采用Fluid C++预测引擎: 包含Fluid C++预测、Fluid-TensorRT预测，下面同时测试了Float32 (FP32) 和Float16 (FP16)的推理速度。

## 推理速度

### V100

| 模型                                         | 是否固定尺寸 | 入网尺寸     | paddle\_inference   | trt\_fp32   | trt\_fp16   |
| ------------------------------------------ | ------ | -------- | ---------- | ---------- | ---------- |
| ppyolo\_r50vd\_dcn\_1x\_coco               | 是      | 608x608  | 20.775677  | 18.40443   | 13.532618  |
| yolov3\_mobilenet\_v1\_270e\_coco          | 是      | 608x608  | 9.742169   | 8.607459   | 6.275342   |
| ssd\_mobilenet\_v1\_300\_120e\_voc         | 是      | 300x300  | 5.175164   | 4.428614   | 4.292153   |
| ttfnet\_darknet53\_1x\_coco                | 是      | 512x512  | 10.14021   | 8.708397   | 5.551765   |
| fcos\_dcn\_r50\_fpn\_1x\_coco              | 是      | 640x640  | 35.471733  | 35.023315  | 34.24144   |
| faster\_rcnn\_r50\_fpn\_1x\_coco           | 否      | 640x640  | 27.999903  | 26.151001  | 21.922865  |
| yolov3\_darknet53\_270e\_coco              | 是      | 608x608  | 17.849056  | 15.431566  | 9.861447   |
| faster\_rcnn\_r50\_fpn\_1x\_coco(800x1312) | 否      | 800x1312 | 32.498821  | 25.536572  | 21.696611  |


### Windows 1080Ti
| 模型                                         | 是否固定尺寸 | 入网尺寸     | paddle\_inference      | trt\_fp32   | trt\_fp16  |
| ------------------------------------------ | ------ | -------- | ---------- | ---------- | --------- |
| ppyolo\_r50vd\_dcn\_1x\_coco               | 是      | 608x608  | 38.066257  | 31.401291  | 31.939096 |
| yolov3\_mobilenet\_v1\_270e\_coco          | 是      | 608x608  | 14.517155  | 11.22542   | 11.125602 |
| ssd\_mobilenet\_v1\_300\_120e\_voc         | 是      | 300x300  | 16.477749  | 13.874813  | 13.761724 |
| ttfnet\_darknet53\_1x\_coco                | 是      | 512x512  | 21.839817  | 17.144808  | 17.092379 |
| fcos\_dcn\_r50\_fpn\_1x\_coco              | 是      | 640x640  | 71.885895  | 69.930206  | 69.523048 |
| faster\_rcnn\_r50\_fpn\_1x\_coco           | 否      | 640x640  | 50.740463  | 57.172909  | 62.081978 |
| yolov3\_darknet53\_270e\_coco              | 是      | 608x608  | 30.260096  | 23.915573  | 24.019217 |
| faster\_rcnn\_r50\_fpn\_1x\_coco(800x1312) | 否      | 800x1312 | 50.314198  | 57.613659  | 62.050724 |

### nv jetson
| 模型                                         | 是否固定尺寸 | 入网尺寸     | paddle\_inference   | trt\_fp32   | trt\_fp16   |
| ------------------------------------------ | ------ | -------- | ---------- | ---------- | ---------- |
| ppyolo\_r50vd\_dcn\_1x\_coco               | 是      | 608x608  | 111.80162  | 99.40332   | 48.047401  |
| yolov3\_mobilenet\_v1\_270e\_coco          | 是      | 608x608  | 48.765278  | 43.832623  | 18.410919  |
| ssd\_mobilenet\_v1\_300\_120e\_voc         | 是      | 300x300  | 10.521894  | 8.840097   | 8.765652   |
| ttfnet\_darknet53\_1x\_coco                | 是      | 512x512  | 73.774796  | 64.025124  | 31.464737  |
| fcos\_dcn\_r50\_fpn\_1x\_coco              | 是      | 640x640  | 217.116684 | 214.381866 | 205.783844 |
| faster\_rcnn\_r50\_fpn\_1x\_coco           | 否      | 640x640  | 169.454346 | 158.919266 | 119.253937 |
| yolov3\_darknet53\_270e\_coco              | 是      | 608x608  | 121.618507 | 110.29866  | 42.379051  |
| faster\_rcnn\_r50\_fpn\_1x\_coco(800x1312) | 否      | 800x1312 | 228.077713 | 156.393372 | 117.026932 |
