
_BASE_: [
  '../datasets/coco_detection.yml',
  '../runtime.yml',
  '../ppyoloe/_base_/ppyoloe_plus_reader.yml',
  '../ppyoloe/_base_/ppyoloe_plus_crn.yml',
  './_base_/optimizer_base_1x.yml'
]


snapshot_epoch: 2
log_iter: 100


epoch: &epoch 30
LearningRate:
  base_lr: 0.0001
  schedulers:
    - !CosineDecay
      max_epochs: *epoch
      min_lr_ratio: 0.01
      # last_plateau_epochs: 10
    - !LinearWarmup
      start_factor: 0.
      epochs: 1


architecture: YOLOv3
norm_type: sync_bn
use_ema: true
ema_decay: 0.9999
ema_skip_names: ['yolo_head.proj_conv.weight', 'backbone.pos_embed']
custom_black_list: ['reduce_mean']
find_unused_parameters: True
use_fused_allreduce_gradients: &use_checkpoint False


YOLOv3:
  backbone: VisionTransformer
  neck: YOLOCSPPAN
  yolo_head: PPYOLOEHead
  post_process: ~


VisionTransformer:
  patch_size: 16
  embed_dim: 768
  depth: 12
  num_heads: 12
  mlp_ratio: 4
  qkv_bias: True
  drop_rate: 0.0
  drop_path_rate: 0.2
  init_values: 0.1
  final_norm: False
  use_rel_pos_bias: False
  use_sincos_pos_emb: True
  epsilon: 0.000001 # 1e-6
  out_indices: [11, ]
  with_fpn: True
  num_fpn_levels: 3
  out_with_norm: False
  use_checkpoint: *use_checkpoint
  pretrained: https://bj.bcebos.com/v1/paddledet/models/pretrained/vit_base_cae_pretrained.pdparams


YOLOCSPPAN:
  in_channels: [768, 768, 768]
  act: 'silu'


PPYOLOEHead:
  fpn_strides: [8, 16, 32]
  in_channels: [768, 768, 768]
  static_assigner_epoch: -1
